<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ceeqwinn Story - Chapter 1</title>
<style>
  :root {
    --brand-gradient: linear-gradient(90deg, red, magenta, gold);
    --light-bg: white;
    --light-text: black;
    --light-paragraph: #f5f5f5;
    --dark-bg: black;
    --dark-text: white;
    --dark-paragraph: rgba(255,255,255,0.05);
  }

  body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    margin: 0;
    background-color: var(--light-bg);
    color: var(--light-text);
    transition: background-color 0.4s ease, color 0.4s ease;
  }
  body.dark {
    background-color: var(--dark-bg);
    color: var(--dark-text);
  }

  header {
    text-align: center;
    padding: 1em;
    background: var(--brand-gradient);
    color: white;
    font-size: 1.5em;
    font-weight: bold;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
  }

  .controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 1em;
    flex-wrap: wrap;
  }
  button {
    padding: 8px 12px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    transition: transform 0.2s ease, background 0.3s ease;
  }
  button:hover {
    transform: scale(1.05);
  }
  .lang-btn { background: magenta; color: white; }
  .maximize-btn { background: gold; color: black; }
  .login-btn { background: red; color: white; }
  .theme-btn { background: silver; color: black; }

  .paragraph {
    background-color: var(--light-paragraph);
    padding: 1em;
    border-radius: 10px;
    margin: 1em auto;
    position: relative;
    max-width: 800px;
    transition: background-color 0.4s ease, font-size 0.3s ease;
    animation: fadeIn 0.6s ease;
  }
  body.dark .paragraph {
    background-color: var(--dark-paragraph);
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .comment-box {
    margin-top: 0.5em;
    padding: 0.5em;
    background-color: rgba(0,0,0,0.05);
    border-radius: 6px;
  }
  body.dark .comment-box {
    background-color: rgba(255,255,255,0.1);
  }
  .comment-input {
    width: 80%;
    padding: 5px;
  }
  .comment-button {
    padding: 5px 10px;
    background: gold;
    color: black;
    border: none;
    cursor: pointer;
  }
  .tooltip {
    position: absolute;
    background: rgba(255,255,255,0.95);
    color: black;
    padding: 5px;
    border-radius: 5px;
    font-size: 0.8em;
    display: none;
    z-index: 10;
  }
</style>
</head>
<body>

<header>ðŸŒŸ Ceeqwinn Story - Chapter 1</header>

<div class="controls">
  <button id="langDecrease" class="lang-btn">âˆ’</button>
  <span id="currentLang">English</span>
  <button id="langIncrease" class="lang-btn">+</button>
  <button id="maximizeBtn" class="maximize-btn">Maximize Text</button>
  <button id="loginBtn" class="login-btn">Login with Google</button>
  <button id="themeToggle" class="theme-btn">Dark Mode</button>
</div>

<div id="story"></div>
<div id="tooltip" class="tooltip"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBWfXYyGYW5ZuvXNQLu9oYL0hDLsnW9w-4",
    authDomain: "alteborne-story.firebaseapp.com",
    projectId: "alteborne-story",
    storageBucket: "alteborne-story.firebasestorage.app",
    messagingSenderId: "696537547705",
    appId: "1:696537547705:web:1f8d65f7d194cb631fec68",
    measurementId: "G-9BXCG8LLDQ"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  let currentUser = null;

  const chapters = {
    en: [
      "Once upon a time, in the city of Alteborne...",
      "The streets were alive with markets, colors, and whispers of mystery..."
    ],
    fr: [
      "Il Ã©tait une fois, dans la ville d'Alteborne...",
      "Les rues Ã©taient animÃ©es de marchÃ©s, de couleurs et de murmures mystÃ©rieux..."
    ],
    xx: [
      "3rd language version of first paragraph...",
      "3rd language version of second paragraph..."
    ]
  };

  const languages = Object.keys(chapters);
  let currentLangIndex = 0;

  function loadStory(lang) {
    document.getElementById("currentLang").textContent =
      lang === "en" ? "English" : lang === "fr" ? "French" : "3rd Language";
    localStorage.setItem("preferredLang", lang);
    const storyContainer = document.getElementById("story");
    storyContainer.innerHTML = "";
    chapters[lang].forEach((para, idx) => {
      const pDiv = document.createElement("div");
      pDiv.className = "paragraph";
      pDiv.dataset.paragraph = `${lang}-p${idx+1}`;
      pDiv.innerHTML = `
        <p>${para}</p>
        <div class="comment-box">
          <input class="comment-input" placeholder="Write a comment..." />
          <button class="comment-button">Post</button>
          <ul class="comment-list"></ul>
        </div>
      `;
      storyContainer.appendChild(pDiv);
      setupComments(pDiv, `${lang}-p${idx+1}`);
    });
  }

  function setupComments(paragraphDiv, paraId) {
    const input = paragraphDiv.querySelector(".comment-input");
    const postBtn = paragraphDiv.querySelector(".comment-button");
    const list = paragraphDiv.querySelector(".comment-list");

    postBtn.addEventListener("click", async () => {
      if (!currentUser) {
        alert("Please log in to comment!");
        return;
      }
      if (input.value.trim()) {
        await addDoc(collection(db, "comments"), {
          text: input.value.trim(),
          paragraph: paraId,
          user: currentUser.displayName,
          timestamp: new Date()
        });
        input.value = "";
      }
    });

    const q = query(collection(db, "comments"), orderBy("timestamp", "desc"));
    onSnapshot(q, snapshot => {
      list.innerHTML = "";
      snapshot.forEach(doc => {
        const data = doc.data();
        if (data.paragraph === paraId) {
          const li = document.createElement("li");
          li.textContent = `${data.user}: ${data.text}`;
          list.appendChild(li);
        }
      });
    });
  }

  document.getElementById("loginBtn").addEventListener("click", async () => {
    const provider = new GoogleAuthProvider();
    try {
      const result = await signInWithPopup(auth, provider);
      currentUser = result.user;
      alert(`Welcome, ${currentUser.displayName}!`);
    } catch (error) {
      console.error("Login error:", error);
    }
  });

  document.getElementById("langIncrease").addEventListener("click", () => {
    currentLangIndex = (currentLangIndex + 1) % languages.length;
    loadStory(languages[currentLangIndex]);
  });

  document.getElementById("langDecrease").addEventListener("click", () => {
    currentLangIndex = (currentLangIndex - 1 + languages.length) % languages.length;
    loadStory(languages[currentLangIndex]);
  });

  let maximized = false;
  document.getElementById("maximizeBtn").addEventListener("click", () => {
    document.querySelectorAll(".paragraph").forEach(div => {
      div.style.fontSize = maximized ? "1em" : "1.4em";
    });
    maximized = !maximized;
  });

  const themeToggle = document.getElementById("themeToggle");
  themeToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    const dark = document.body.classList.contains("dark");
    themeToggle.textContent = dark ? "Light Mode" : "Dark Mode";
    localStorage.setItem("theme", dark ? "dark" : "light");
  });

  const savedTheme = localStorage.getItem("theme");
  if (savedTheme === "dark") {
    document.body.classList.add("dark");
    themeToggle.textContent = "Light Mode";
  }

  const savedLang = localStorage.getItem("preferredLang");
  if (savedLang && languages.includes(savedLang)) {
    currentLangIndex = languages.indexOf(savedLang);
  }

  loadStory(languages[currentLangIndex]);
</script>
</body>
</html>
